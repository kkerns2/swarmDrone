<?xml version="1.0" encoding="UTF-8"?>

<launch>
	<arg name="slam"/>

	<!-- If the user wants SLAM, spawn at the four corners of the map-->
	  <group if="$(arg slam)">

			<!-- Spawn Drone 1 -->
			<group ns="drone1">
				<include file="$(find swarm)/launch/single_drone.launch">
				<arg name="x" value="-40"/>
				<arg name="y" value="-42"/>
				<arg name="drone_name" value="drone1"/>
					<arg name="slam" value="$(arg slam)"/> 
				</include>
			</group>
			
			<!-- Spawn Drone 2 -->
			<group ns="drone2">
				<include file="$(find swarm)/launch/single_drone.launch">
				<arg name="x" value="-42"/>
				<arg name="y" value="40"/>
				<arg name="drone_name" value="drone2"/>
					<arg name="slam" value="$(arg slam)"/> 
				</include>
			</group>

			<!-- Spawn Drone 3 -->
			<group ns="drone3">
				<include file="$(find swarm)/launch/single_drone.launch">
				<arg name="x" value="120"/>
				<arg name="y" value="-44"/>
				<arg name="drone_name" value="drone3"/>
					<arg name="slam" value="$(arg slam)"/> 
				</include>
			</group>

			<!-- Spawn Drone 4-->
			<group ns="drone4">
				<include file="$(find swarm)/launch/single_drone.launch">
				<arg name="x" value="120"/>
				<arg name="y" value="44"/>
				<arg name="drone_name" value="drone4"/>
					<arg name="slam" value="$(arg slam)"/> 
				</include>
			</group>
	</group> 

	<!-- Unless the user is on navigation mode (slam is false)-->
       <group unless="$(arg slam)">
			<param name="/use_sim_time" value="true"/>
    		<arg name="map_file" default="/home/mcp/catkin_ws/src/swarm/maps/maps_1.yaml"/>
			<node name="map_server" pkg="map_server" type="map_server" args="$(arg map_file)">
        		<param name="frame_id"  value="map"/>
		    </node>

			<!-- Spawn Drone 1 -->
			<group ns="drone1">
				<include file="$(find swarm)/launch/single_drone.launch">
				<arg name="x" value="-42"/>
				<arg name="y" value="40"/>
				<arg name="drone_name" value="drone1"/>
					<arg name="slam" value="$(arg slam)"/> 
				</include>
			
				<include file="$(find swarm)/launch/move_base_1.launch">
        	   		<arg name="tf_prefix" value="drone1"/>
           			<arg name="odom_frame_id" value="drone1/world"/>
	        	</include>

			</group>
			
			<!-- Spawn Drone 2 -->
			<group ns="drone2">
				<include file="$(find swarm)/launch/single_drone.launch">
				<arg name="x" value="110"/>
				<arg name="y" value="24"/>
				<arg name="drone_name" value="drone2"/>
					<arg name="slam" value="$(arg slam)"/> 
				</include>

				 <include file="$(find swarm)/launch/move_base_1.launch">
           			<arg name="tf_prefix" value="drone2"/>
           			<arg name="odom_frame_id" value="drone2/world"/>
		        </include>
			</group>

			<!-- Spawn Drone 3 -->
			<group ns="drone3">
				<include file="$(find swarm)/launch/single_drone.launch">
				<arg name="x" value="-42"/>
				<arg name="y" value="1"/>
				<arg name="drone_name" value="drone3"/>
					<arg name="slam" value="$(arg slam)"/> 
				</include>

				 <include file="$(find swarm)/launch/move_base_1.launch">
           			<arg name="tf_prefix" value="drone3"/>
        		   <arg name="odom_frame_id" value="drone3/world"/>
		        </include>
			</group>

			<!-- Spawn Drone 4-->
			<group ns="drone4">
				<include file="$(find swarm)/launch/single_drone.launch">
				<arg name="x" value="-42"/>
				<arg name="y" value="-26"/>
				<arg name="drone_name" value="drone4"/>
					<arg name="slam" value="$(arg slam)"/> 
				</include>

				 <include file="$(find swarm)/launch/move_base_1.launch">
           		   <arg name="tf_prefix" value="drone4"/>
        		   <arg name="odom_frame_id" value="drone4/world"/>
		        </include>
			</group>

				<include file="$(find swarm)/launch/amcl.launch">
           			<arg name="tf_prefix" value="drone1"/>
           			<arg name="odom_frame_id" value="drone1/world"/> 
            		<arg name="initial_pose_x" value="-42"/>
        		    <arg name="initial_pose_y" value="40"/>
		        </include>

				<include file="$(find swarm)/launch/amcl.launch">
            		<arg name="tf_prefix" value="drone2"/>
            		<arg name="odom_frame_id" value="drone2/world"/> 
            		<arg name="initial_pose_x" value="110"/>
           			<arg name="initial_pose_y" value="24"/>
        		</include>

				<include file="$(find swarm)/launch/amcl.launch">
           			<arg name="tf_prefix" value="drone3"/>
           			<arg name="odom_frame_id" value="drone3/world"/> 
            		<arg name="initial_pose_x" value="-42"/>
            		<arg name="initial_pose_y" value="1"/>
		        </include>

				<include file="$(find swarm)/launch/amcl.launch">
            		<arg name="tf_prefix" value="drone4"/>
            		<arg name="odom_frame_id" value="drone4/world"/> 
            		<arg name="initial_pose_x" value="-42"/>
            		<arg name="initial_pose_y" value="-26"/>
		        </include>

	 		<!-- Start rviz visualization with preset config -->
 			 <node pkg="rviz" type="rviz" name="rviz" args="-d $(find swarm)/rviz/all_drone_nav.rviz"/>
 	   </group>
</launch>
